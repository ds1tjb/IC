<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2025 ë“±êµì§€ë„ ì‹œìŠ¤í…œ</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f0f4f8;
      color: #333;
      text-align: center;
      margin: 0;
      padding: 2rem;
      font-size: 2rem;
    }
    h1 {
      color: #0077cc;
      font-size: 3rem;
      margin-bottom: 2rem;
    }
    input#studentId {
      font-size: 3rem;
      padding: 1rem;
      width: 80%;
      text-align: center;
      margin-bottom: 2rem;
      border-radius: 1rem;
      border: 2px solid #ccc;
    }
    .keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      max-width: 600px;
      margin: 0 auto 2rem;
    }
    .keypad button {
      font-size: 3rem;
      padding: 2rem;
      border: none;
      border-radius: 1.5rem;
      background: #e0f3ff;
      transition: 0.2s;
    }
    .keypad button:hover {
      background: #bfe4ff;
    }
.admin-action-button {
  font-size: 2.2rem;
  padding: 1.2rem 2rem;
  margin: 1rem auto;
  border-radius: 1.2rem;
  border: none;
  background: #ffd966;
  width: 450px;       /* ê³ ì • ë„ˆë¹„ */
  display: block;
}
.admin-action-button:hover {
  background: #ffcc33;
}
.admin-action-button.danger {
  background: #ff8888;
  color: white;
}
.admin-action-button.danger:hover {
  background: #ff4d4d;
}
    .photo {
      width: 300px;
      height: 400px;
      object-fit: cover;
      border: 3px dashed #aaa;
      margin: 2rem auto;
    }
    .actions button {
      font-size: 2.2rem;
      padding: 1.2rem 2rem;
      margin: 1rem;
      border-radius: 1.2rem;
      border: none;
      background: #ffe066;
      min-width: 300px;
    }
    .student-info {
      font-size: 2rem;
      margin-top: 1rem;
    }
    .return-btn, .admin-button-container button {
      font-size: 2rem;
      padding: 1rem 2rem;
      margin-top: 2rem;
      border-radius: 1rem;
      border: none;
      background: #ccc;
    }
    table {
      font-size: 1.8rem;
      width: 100%;
      margin-top: 2rem;
      border-collapse: collapse;
    }
    th, td {
      border: 2px solid #aaa;
      padding: 1rem;
    }
    th {
      background: #ddefff;
    }
    #adminSection input {
      font-size: 2rem;
      padding: 1rem;
      width: 300px;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>2025 ë“±êµì§€ë„ ì‹œìŠ¤í…œ</h1>

  <div id="inputSection">
    <input type="text" id="studentId" placeholder="í•™ë²ˆ ì…ë ¥ (5ìë¦¬)" readonly />
    <div class="keypad" id="keypad"></div>
    <div class="admin-button-container">
      <button id="adminModeBtn" onclick="requestAdminMode()">ğŸ” ê´€ë¦¬ìëª¨ë“œ</button>
    </div>
  </div>

  <div id="photoSection" style="display:none;">
    <img id="studentPhoto" class="photo" src="" alt="í•™ìƒ ì‚¬ì§„" />
    <div id="photoMessage" class="student-info"></div>

    <div class="actions">
      <button onclick="addViolation('ë³µì¥ ê·œì • ìœ„ë°˜')">ğŸ‘• ë³µì¥ ê·œì • ìœ„ë°˜</button><br>
      <button onclick="addViolation('íƒœë„ ë¶ˆëŸ‰')">ğŸ˜  íƒœë„ ë¶ˆëŸ‰</button><br>
      <button onclick="addViolation('ê¸°íƒ€ ìœ„ë°˜')">âš  ê¸°íƒ€ ìœ„ë°˜</button><br>
    </div>
    <button class="return-btn" onclick="goToStart()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
  </div>

  <div id="adminSection" style="display:none;">
    <h2>ğŸ“‹ ì „ì²´ ê¸°ë¡</h2>
    <div id="adminLogs"></div>
    <button class="admin-action-button" onclick="downloadCSV()">ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°</button>
<button class="admin-action-button danger" onclick="clearAllLogs()">ğŸ—‘ ëª¨ë“  ê¸°ë¡ ì‚­ì œ</button>

<button class="admin-action-button danger" onclick="deleteSpecificLog()">âŒ íŠ¹ì • í•™ë²ˆ ì‚­ì œ</button>
<input id="deleteIdInput" placeholder="ì‚­ì œí•  í•™ë²ˆ ì…ë ¥" /><br>
    <button class="return-btn" onclick="goToStart()">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
  </div>

  <script>
    const keypad = document.getElementById("keypad");
    const keys = ['1','2','3','4','5','6','7','8','9','â†','0','í™•ì¸'];
    keys.forEach(key => {
      const btn = document.createElement("button");
      btn.textContent = key;
      btn.onclick = () => {
        if (key === 'â†') studentIdInput.value = studentIdInput.value.slice(0, -1);
        else if (key === 'í™•ì¸') validateId();
        else studentIdInput.value += key;
      };
      keypad.appendChild(btn);
    });

    const studentIdInput = document.getElementById("studentId");
    const photoSection = document.getElementById("photoSection");
    const inputSection = document.getElementById("inputSection");
    const studentPhoto = document.getElementById("studentPhoto");
    const photoMessage = document.getElementById("photoMessage");
    const adminSection = document.getElementById("adminSection");
    const adminLogs = document.getElementById("adminLogs");
    const studentNames = {
      "20231234": "í™ê¸¸ë™",
      "20239876": "ê¹€ì² ìˆ˜"
    };

    function validateId() {
      const id = studentIdInput.value;
      if (!id) return alert("í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”.");
      inputSection.style.display = "none";
      photoSection.style.display = "block";
      loadPhoto(id);
      showStudentHistory(id);
    }

    function loadPhoto(id) {
      studentPhoto.src = `images/${id}.jpg`;
      studentPhoto.onerror = () => {
        studentPhoto.src = "images/default.jpg";
        photoMessage.innerHTML = `<p>ì‚¬ì§„ ì—†ìŒ: ê¸°ë³¸ ì´ë¯¸ì§€ ì‚¬ìš©</p><p>í•™ë²ˆ: ${id}</p>`;
        showStudentHistory(id);
      };
      studentPhoto.onload = () => {
        photoMessage.innerHTML = `<p>í•™ë²ˆ: ${id}</p>`;
        showStudentHistory(id);
      };
    }

   function showStudentHistory(id) {
  const log = JSON.parse(localStorage.getItem(`log_${id}`) || "[]");
  if (log.length > 0) {
    const historyHTML = log.map(l => {
      const cleanTime = l.timestamp.replace(/:\d{2}$/, ''); // ì´ˆ ì œê±°
      return `ğŸ“Œ ${cleanTime} - ${l.reason}`;
    }).join("<br>");
    photoMessage.innerHTML += `
      <div style="margin-top:1rem;">
        <div style="text-align:center; font-size:1.6rem;"><strong>- ì´ì „ ê¸°ë¡ -</strong></div>
        <div style="text-align:left; font-size:1.6rem;">${historyHTML}</div>
      </div>`;
  } else {
    photoMessage.innerHTML += `
      <div style="margin-top:1rem; text-align:center; font-size:1.6rem;">
        <em>ì´ì „ ê¸°ë¡ ì—†ìŒ</em>
      </div>`;
  }
}


    function addViolation(reason) {
      const id = studentIdInput.value;
      const timestamp = new Date().toLocaleString();
      const log = JSON.parse(localStorage.getItem(`log_${id}`) || "[]");
      log.push({ timestamp, reason });
      localStorage.setItem(`log_${id}`, JSON.stringify(log));
      alert(`${reason} ê¸°ë¡ë¨`);
      goToStart();
    }

    function goToStart() {
      studentIdInput.value = "";
      inputSection.style.display = "block";
      photoSection.style.display = "none";
      adminSection.style.display = "none";
    }

    function requestAdminMode() {
      const pwd = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
      if (pwd === "11200") {
        inputSection.style.display = "none";
        adminSection.style.display = "block";
        viewAllLogs();
      } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }
    }

    function viewAllLogs() {
      const logs = [];
      for (let key in localStorage) {
        if (key.startsWith("log_")) {
          const id = key.replace("log_", "");
          const name = studentNames[id] || "";
          const data = JSON.parse(localStorage.getItem(key));
          data.forEach(entry => {
            logs.push({ id, name, timestamp: entry.timestamp, reason: entry.reason });
          });
        }
      }
      renderTable(logs);
    }

    function renderTable(logs) {
      let table = `<table><thead><tr>
        <th>í•™ë²ˆ</th><th>ì„±ëª…</th><th>ì¼ì‹œ</th><th>ì‚¬ìœ </th></tr></thead><tbody>`;
      logs.forEach(row => {
        table += `<tr><td>${row.id}</td><td>${row.name}</td><td>${row.timestamp}</td><td>${row.reason}</td></tr>`;
      });
      table += "</tbody></table>";
      adminLogs.innerHTML = table;
    }

    function downloadCSV() {
      let csv = "í•™ë²ˆ,ì„±ëª…,ì¼ì‹œ,ì‚¬ìœ \n";
      for (let key in localStorage) {
        if (key.startsWith("log_")) {
          const id = key.replace("log_", "");
          const logs = JSON.parse(localStorage.getItem(key));
          logs.forEach(log => {
            csv += `${id},${studentNames[id] || ''},${log.timestamp},${log.reason}\n`;
          });
        }
      }
      const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "student_logs.csv";
      a.click();
    }

    function clearAllLogs() {
      if (confirm("ì •ë§ ëª¨ë“  ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) {
        for (let key in localStorage) {
          if (key.startsWith("log_")) localStorage.removeItem(key);
        }
        alert("ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        viewAllLogs();
      }
    }

    function deleteSpecificLog() {
      const id = document.getElementById("deleteIdInput").value.trim();
      if (!id) return alert("í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”.");
      if (localStorage.getItem(`log_${id}`)) {
        localStorage.removeItem(`log_${id}`);
        alert(`${id}ë²ˆ ê¸°ë¡ ì‚­ì œë¨`);
        viewAllLogs();
      } else {
        alert("í•´ë‹¹ í•™ë²ˆ ê¸°ë¡ ì—†ìŒ");
      }
    }
  </script>
</body>
</html>
